CLI/API based interaction with IBP

Create network
- Authenticate
    - Get API key
        - dbtGIRVCwT5tMH0HqK0t6GnIHRCAhKcWbR_GpasIaHKD
    - Get API endpoint
        - https://e732a640f7bf422fb63607ed1ef45d05-optools.bp01.blockchain.cloud.ibm.com
    - Get IAM token
	curl -X POST \
	 	https://iam.cloud.ibm.com/identity/token \
	 	-H "Content-Type: application/x-www-form-urlencoded" \
  	-H "Accept: application/json" \
  	-d "grant_type=urn%3Aibm%3Aparams%3Aoauth%3Agrant-type%3Aapikey&apikey=UmdVP-hGR6Lvmf8bJmfm3UuFrWhptOPiQNmUR9-RAI5D"

eyJraWQiOiIyMDE5MDUxMyIsImFsZyI6IlJTMjU2In0.eyJpYW1faWQiOiJpYW0tU2VydmljZUlkLWE3N2NjOTA3LTNiNGQtNDJjYy1hMTIyLTA4NTdlMTNkZWE1NiIsImlkIjoiaWFtLVNlcnZpY2VJZC1hNzdjYzkwNy0zYjRkLTQyY2MtYTEyMi0wODU3ZTEzZGVhNTYiLCJyZWFsbWlkIjoiaWFtIiwiaWRlbnRpZmllciI6IlNlcnZpY2VJZC1hNzdjYzkwNy0zYjRkLTQyY2MtYTEyMi0wODU3ZTEzZGVhNTYiLCJzdWIiOiJTZXJ2aWNlSWQtYTc3Y2M5MDctM2I0ZC00MmNjLWExMjItMDg1N2UxM2RlYTU2Iiwic3ViX3R5cGUiOiJTZXJ2aWNlSWQiLCJhY2NvdW50Ijp7InZhbGlkIjp0cnVlLCJic3MiOiI1MzJmNWZlZDczZDQ2ZWNmYjUyZDk5ODRiYzUyNmI3ZSJ9LCJpYXQiOjE1NjQwODk5NTcsImV4cCI6MTU2NDA5MzU1NywiaXNzIjoiaHR0cHM6Ly9pYW0uY2xvdWQuaWJtLmNvbS9pZGVudGl0eSIsImdyYW50X3R5cGUiOiJ1cm46aWJtOnBhcmFtczpvYXV0aDpncmFudC10eXBlOmFwaWtleSIsInNjb3BlIjoiaWJtIG9wZW5pZCIsImNsaWVudF9pZCI6ImRlZmF1bHQiLCJhY3IiOjEsImFtciI6WyJwd2QiXX0.JUXbQ7JNw5qhYQ8GheB7uIOMpsdBvgbXd4oPQ5usDAmeOYqAGg5SjyQF73K-0UpZ6C1ERZVEC5HmVi9tjayYtJTMiJbJ1xHBtaYv9qMDf2brBx6XMm72_hfitk1r2E2I93WbZbdQcbJh3l6xZ-rkCKQJciv9056KmucVlBN8dq7WWtBVlGMC3pBkLeFXy3CH6MTxkUWK9njYi8XZb6P2GeDkuULEWZTE8B3YDz8hDClN_lnxXfxZ7X4ws7sB9XN0MpeIYkyVTjVhAzdQlPWfZpC9BRTkIelNg2VQGu0bswbfvAMWPHFNkhRe78dOz73LcBKhlzcYZt3_uKRNTGc5rw


- Create Peer
- Create Orderer
- Create consortium
- Create channel
- Add peer to channel
Register users
Package/install/instantiate smart contracts


Get all components

curl -X GET \
  https://e732a640f7bf422fb63607ed1ef45d05-optools.bp01.blockchain.cloud.ibm.com/ak/api/v1/components \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer eyJraWQiOiIyMDE5MDUxMyIsImFsZyI6IlJTMjU2In0.eyJpYW1faWQiOiJpYW0tU2VydmljZUlkLWE3N2NjOTA3LTNiNGQtNDJjYy1hMTIyLTA4NTdlMTNkZWE1NiIsImlkIjoiaWFtLVNlcnZpY2VJZC1hNzdjYzkwNy0zYjRkLTQyY2MtYTEyMi0wODU3ZTEzZGVhNTYiLCJyZWFsbWlkIjoiaWFtIiwiaWRlbnRpZmllciI6IlNlcnZpY2VJZC1hNzdjYzkwNy0zYjRkLTQyY2MtYTEyMi0wODU3ZTEzZGVhNTYiLCJzdWIiOiJTZXJ2aWNlSWQtYTc3Y2M5MDctM2I0ZC00MmNjLWExMjItMDg1N2UxM2RlYTU2Iiwic3ViX3R5cGUiOiJTZXJ2aWNlSWQiLCJhY2NvdW50Ijp7InZhbGlkIjp0cnVlLCJic3MiOiI1MzJmNWZlZDczZDQ2ZWNmYjUyZDk5ODRiYzUyNmI3ZSJ9LCJpYXQiOjE1NjQwODI1NTcsImV4cCI6MTU2NDA4NjE1NywiaXNzIjoiaHR0cHM6Ly9pYW0uY2xvdWQuaWJtLmNvbS9pZGVudGl0eSIsImdyYW50X3R5cGUiOiJ1cm46aWJtOnBhcmFtczpvYXV0aDpncmFudC10eXBlOmFwaWtleSIsInNjb3BlIjoiaWJtIG9wZW5pZCIsImNsaWVudF9pZCI6ImRlZmF1bHQiLCJhY3IiOjEsImFtciI6WyJwd2QiXX0.gEWrtPfUzCaErf_vsV0-WMEoCrxd9x4AgAGeirwDMFy1LNyuOxPcVW2xOkymmZhJ9KZa59fnKbXP4jng86po2ESriJlVaWzQTxhkloc2nyCewFVV8O42hTleAMo3-fxLxxwU6_UmGOpehVi4W9VjSY-UQAQgvkE0xq1eCfmLJYwIz4hOOutWbTHIS9sehffFRVVL7T8WScJGfMnwM9dwvTq_YH_wGbBPxOOnRrJE1GtsBmNW01Kv-aE-lC7rfuehE_oBOxo5C0FjIZFCW3ix3aM8Ppc0rUbYHj3wH5u_bvTdH70cHobwDFJl6sCmJqdd2832zTNfAPm_fQZEqzRwcw'

Create CA for Org1

curl -X POST \
  https://e732a640f7bf422fb63607ed1ef45d05-optools.bp01.blockchain.cloud.ibm.com/ak/api/v1/kubernetes/components/ca \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer eyJraWQiOiIyMDE5MDIwNCIsImFsZyI6IlJTMjU2In0.eyJpYW1faWQiOiJpYW0tU2VydmljZUlkLWE3N2NjOTA3LTNiNGQtNDJjYy1hMTIyLTA4NTdlMTNkZWE1NiIsImlkIjoiaWFtLVNlcnZpY2VJZC1hNzdjYzkwNy0zYjRkLTQyY2MtYTEyMi0wODU3ZTEzZGVhNTYiLCJyZWFsbWlkIjoiaWFtIiwiaWRlbnRpZmllciI6IlNlcnZpY2VJZC1hNzdjYzkwNy0zYjRkLTQyY2MtYTEyMi0wODU3ZTEzZGVhNTYiLCJzdWIiOiJTZXJ2aWNlSWQtYTc3Y2M5MDctM2I0ZC00MmNjLWExMjItMDg1N2UxM2RlYTU2Iiwic3ViX3R5cGUiOiJTZXJ2aWNlSWQiLCJhY2NvdW50Ijp7InZhbGlkIjp0cnVlLCJic3MiOiI1MzJmNWZlZDczZDQ2ZWNmYjUyZDk5ODRiYzUyNmI3ZSJ9LCJpYXQiOjE1NjM5MTEzNjIsImV4cCI6MTU2MzkxNDk2MiwiaXNzIjoiaHR0cHM6Ly9pYW0uY2xvdWQuaWJtLmNvbS9pZGVudGl0eSIsImdyYW50X3R5cGUiOiJ1cm46aWJtOnBhcmFtczpvYXV0aDpncmFudC10eXBlOmFwaWtleSIsInNjb3BlIjoiaWJtIG9wZW5pZCIsImNsaWVudF9pZCI6ImRlZmF1bHQiLCJhY3IiOjEsImFtciI6WyJwd2QiXX0.OXwLO8kDn9yHYlr9LyRdv6U-jStAjmO4RGtZkenhzxYftujv4EoaYF2HABbi_PDo7oBYCitehVdYakMP5Ubr-OmDFzeXfWYbicXZSVCnuD3ChnkgFREYi0JyMxQTp13Al4iUKQhR09QLOp-G6v84K7HwJUZfY1Hryf2ILz2ExCLGi1M8s_FsnVadmVw4NuyG6-bUoWKGpBcWvxx6UJEpRgYQvygcSJuug7k6y6JIdH-pB6A6_4BGNKRWoNTOuJ3fXBZYt-Bu4vNCXW1g6ymh0WA818WadX2Pqd-F7uOqkbHQ8t0S-b7vu7tRxmvkvSDMJYa9iwyLxHZLz62nHFxmCQ' \
  -d '{
    "display_name": "Org1 CA",
    "enroll_id": "admin",
    "enroll_secret": "adminpw"
    }'

Create CA for Org2 

curl -X POST \
  https://e732a640f7bf422fb63607ed1ef45d05-optools.bp01.blockchain.cloud.ibm.com/ak/api/v1/kubernetes/components/ca \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer eyJraWQiOiIyMDE5MDIwNCIsImFsZyI6IlJTMjU2In0.eyJpYW1faWQiOiJpYW0tU2VydmljZUlkLWE3N2NjOTA3LTNiNGQtNDJjYy1hMTIyLTA4NTdlMTNkZWE1NiIsImlkIjoiaWFtLVNlcnZpY2VJZC1hNzdjYzkwNy0zYjRkLTQyY2MtYTEyMi0wODU3ZTEzZGVhNTYiLCJyZWFsbWlkIjoiaWFtIiwiaWRlbnRpZmllciI6IlNlcnZpY2VJZC1hNzdjYzkwNy0zYjRkLTQyY2MtYTEyMi0wODU3ZTEzZGVhNTYiLCJzdWIiOiJTZXJ2aWNlSWQtYTc3Y2M5MDctM2I0ZC00MmNjLWExMjItMDg1N2UxM2RlYTU2Iiwic3ViX3R5cGUiOiJTZXJ2aWNlSWQiLCJhY2NvdW50Ijp7InZhbGlkIjp0cnVlLCJic3MiOiI1MzJmNWZlZDczZDQ2ZWNmYjUyZDk5ODRiYzUyNmI3ZSJ9LCJpYXQiOjE1NjM5MTEzNjIsImV4cCI6MTU2MzkxNDk2MiwiaXNzIjoiaHR0cHM6Ly9pYW0uY2xvdWQuaWJtLmNvbS9pZGVudGl0eSIsImdyYW50X3R5cGUiOiJ1cm46aWJtOnBhcmFtczpvYXV0aDpncmFudC10eXBlOmFwaWtleSIsInNjb3BlIjoiaWJtIG9wZW5pZCIsImNsaWVudF9pZCI6ImRlZmF1bHQiLCJhY3IiOjEsImFtciI6WyJwd2QiXX0.OXwLO8kDn9yHYlr9LyRdv6U-jStAjmO4RGtZkenhzxYftujv4EoaYF2HABbi_PDo7oBYCitehVdYakMP5Ubr-OmDFzeXfWYbicXZSVCnuD3ChnkgFREYi0JyMxQTp13Al4iUKQhR09QLOp-G6v84K7HwJUZfY1Hryf2ILz2ExCLGi1M8s_FsnVadmVw4NuyG6-bUoWKGpBcWvxx6UJEpRgYQvygcSJuug7k6y6JIdH-pB6A6_4BGNKRWoNTOuJ3fXBZYt-Bu4vNCXW1g6ymh0WA818WadX2Pqd-F7uOqkbHQ8t0S-b7vu7tRxmvkvSDMJYa9iwyLxHZLz62nHFxmCQ' \
  -d '{
    "display_name": "Org2 CA",
    "enroll_id": "admin",
    "enroll_secret": "adminpw"
    }'

org 3

curl -X POST \
  https://e732a640f7bf422fb63607ed1ef45d05-optools.bp01.blockchain.cloud.ibm.com/ak/api/v1/kubernetes/components/ca \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer eyJraWQiOiIyMDE5MDUxMyIsImFsZyI6IlJTMjU2In0.eyJpYW1faWQiOiJpYW0tU2VydmljZUlkLWE3N2NjOTA3LTNiNGQtNDJjYy1hMTIyLTA4NTdlMTNkZWE1NiIsImlkIjoiaWFtLVNlcnZpY2VJZC1hNzdjYzkwNy0zYjRkLTQyY2MtYTEyMi0wODU3ZTEzZGVhNTYiLCJyZWFsbWlkIjoiaWFtIiwiaWRlbnRpZmllciI6IlNlcnZpY2VJZC1hNzdjYzkwNy0zYjRkLTQyY2MtYTEyMi0wODU3ZTEzZGVhNTYiLCJzdWIiOiJTZXJ2aWNlSWQtYTc3Y2M5MDctM2I0ZC00MmNjLWExMjItMDg1N2UxM2RlYTU2Iiwic3ViX3R5cGUiOiJTZXJ2aWNlSWQiLCJhY2NvdW50Ijp7InZhbGlkIjp0cnVlLCJic3MiOiI1MzJmNWZlZDczZDQ2ZWNmYjUyZDk5ODRiYzUyNmI3ZSJ9LCJpYXQiOjE1NjQwODk5NTcsImV4cCI6MTU2NDA5MzU1NywiaXNzIjoiaHR0cHM6Ly9pYW0uY2xvdWQuaWJtLmNvbS9pZGVudGl0eSIsImdyYW50X3R5cGUiOiJ1cm46aWJtOnBhcmFtczpvYXV0aDpncmFudC10eXBlOmFwaWtleSIsInNjb3BlIjoiaWJtIG9wZW5pZCIsImNsaWVudF9pZCI6ImRlZmF1bHQiLCJhY3IiOjEsImFtciI6WyJwd2QiXX0.JUXbQ7JNw5qhYQ8GheB7uIOMpsdBvgbXd4oPQ5usDAmeOYqAGg5SjyQF73K-0UpZ6C1ERZVEC5HmVi9tjayYtJTMiJbJ1xHBtaYv9qMDf2brBx6XMm72_hfitk1r2E2I93WbZbdQcbJh3l6xZ-rkCKQJciv9056KmucVlBN8dq7WWtBVlGMC3pBkLeFXy3CH6MTxkUWK9njYi8XZb6P2GeDkuULEWZTE8B3YDz8hDClN_lnxXfxZ7X4ws7sB9XN0MpeIYkyVTjVhAzdQlPWfZpC9BRTkIelNg2VQGu0bswbfvAMWPHFNkhRe78dOz73LcBKhlzcYZt3_uKRNTGc5rw' \
  -d '{
    "display_name": "Org3 CA",
    "enroll_id": "admin",
    "enroll_secret": "adminpw"
    }'

get components again

get tls cert | base64 --decode > org1tlscert.pem
get tls cert | base64 --decode > org2tlscert.pem

export tls cert locations here

Enroll users (Will need to use the fabric-ca-client library for the following steps)

org1 admin
export ORG1_TLS_CERT=/Users/odrodrig@us.ibm.com/Documents/GitHub/IBP_script/credentials/org1TLScert.pem

1. Enroll 

org 1
fabric-ca-client enroll --caname ca --tls.certfiles /Users/odrodrig\@us.ibm.com/Documents/GitHub/IBP_script/credentials/org1tlscert.pem -u https://admin:adminpw@184.172.252.242:30164

org2
fabric-ca-client enroll --caname ca --tls.certfiles /Users/odrodrig\@us.ibm.com/Documents/GitHub/IBP_script/credentials/org3tlscert.pem -u https://admin:adminpw@184.172.252.242:31829


2. Register 

org1Peer identity

org2 admin
org2Peer identity